<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>gmp Portal â€“ Auto Teste</title>
  <link rel="stylesheet" href="assets/css/gmp-portal.css">
  <style>
    .test-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    .test-header { text-align: center; margin-bottom: 30px; }
    .test-console {
      background: #1e1e1e; color: #fff; padding: 20px;
      border-radius: 8px; font-family: 'Courier New', monospace;
      font-size: 14px; height: 500px; overflow-y: auto; margin-bottom: 20px;
    }
    .test-controls { text-align: center; margin-bottom: 20px; }
    .test-button {
      background: #007bff; color: white; border: none;
      padding: 10px 20px; border-radius: 4px; cursor: pointer;
      margin: 0 10px; font-size: 16px;
    }
    .test-button:hover { background: #0056b3; }
    .test-button:disabled { background: #6c757d; cursor: not-allowed; }
    .test-summary { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center; }
    .summary-item { background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }
    .summary-item h4 { margin: 0 0 10px 0; color: #333; }
    .summary-item .value { font-size: 24px; font-weight: bold; color: #007bff; }
    .status-success { color: #28a745; }
    .status-error { color: #dc3545; }
    .status-warning { color: #ffc107; }
    .status-info { color: #17a2b8; }
    .progress-bar { width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin: 20px 0; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #007bff, #28a745); transition: width 0.3s ease; }
    .log-line { margin: 2px 0; padding: 2px 0; }
    .log-success { color: #28a745; }
    .log-error { color: #dc3545; }
    .log-warning { color: #ffc107; }
    .log-info { color: #17a2b8; }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>gmp Portal â€“ Auto Teste do Sistema</h1>
      <p>ValidaÃ§Ã£o completa das funcionalidades e desempenho do sistema</p>
    </div>

    <div class="test-controls">
      <button id="runTest" class="test-button">Executar teste completo</button>
      <button id="clearConsole" class="test-button">Limpar console</button>
      <button id="exportReport" class="test-button">Exportar relatÃ³rio</button>
    </div>

    <div class="progress-bar">
      <div id="progressFill" class="progress-fill" style="width: 0%"></div>
    </div>

    <div class="test-summary">
      <div class="summary-grid">
        <div class="summary-item">
          <h4>Total de Testes</h4>
          <div id="totalTests" class="value">0</div>
        </div>
        <div class="summary-item">
          <h4>Sucesso</h4>
          <div id="successTests" class="value status-success">0</div>
        </div>
        <div class="summary-item">
          <h4>Falha</h4>
          <div id="errorTests" class="value status-error">0</div>
        </div>
        <div class="summary-item">
          <h4>Avisos</h4>
          <div id="warningTests" class="value status-warning">0</div>
        </div>
        <div class="summary-item">
          <h4>Taxa de Sucesso</h4>
          <div id="successRate" class="value">0%</div>
        </div>
        <div class="summary-item">
          <h4>DuraÃ§Ã£o</h4>
          <div id="testDuration" class="value">0ms</div>
        </div>
      </div>
    </div>

    <div id="testConsole" class="test-console">
      <div class="log-line log-info">ðŸš€ Sistema de Auto Teste pronto</div>
      <div class="log-line log-info">Clique em "Executar teste completo" para iniciar...</div>
    </div>
  </div>

  <!-- Imports -->
  <script src="assets/js/security.js"></script>
  <script src="assets/js/database.js"></script>
  <script src="quick-test.js"></script>

  <script>
    const originalLog = console.log;
    const consoleElement = document.getElementById('testConsole');

    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.join(' ');
      const logLine = document.createElement('div');
      logLine.className = 'log-line';
      if (message.includes('[SUCCESS]')) logLine.className += ' log-success';
      else if (message.includes('[ERROR]')) logLine.className += ' log-error';
      else if (message.includes('[WARNING]')) logLine.className += ' log-warning';
      else if (message.includes('[INFO]')) logLine.className += ' log-info';
      logLine.textContent = message;
      consoleElement.appendChild(logLine);
      consoleElement.scrollTop = consoleElement.scrollHeight;
    };

    let testRunner = null;
    let isTestRunning = false;

    function updateTestStats(results) {
      const totalTests = results.length;
      const successTests = results.filter(r => r.status === 'success').length;
      const errorTests = results.filter(r => r.status === 'error').length;
      const warningTests = results.filter(r => r.status === 'warning').length;
      const successRate = totalTests > 0 ? Math.round((successTests / totalTests) * 100) : 0;
      document.getElementById('totalTests').textContent = totalTests;
      document.getElementById('successTests').textContent = successTests;
      document.getElementById('errorTests').textContent = errorTests;
      document.getElementById('warningTests').textContent = warningTests;
      document.getElementById('successRate').textContent = successRate + '%';
    }

    function updateProgress(current, total) {
      const percentage = total > 0 ? Math.round((current / total) * 100) : 0;
      document.getElementById('progressFill').style.width = percentage + '%';
    }

    // Ligar botÃµes aos handlers
    document.getElementById("runTest").addEventListener("click", runTest);
    document.getElementById("clearConsole").addEventListener("click", () => {
      consoleElement.innerHTML = "";
    });
    document.getElementById("exportReport").addEventListener("click", () => {
      const logs = consoleElement.innerText;
      const blob = new Blob([logs], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "auto-test-report.txt";
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
