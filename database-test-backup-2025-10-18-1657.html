<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Gerenciador de Banco de Dados</title>
    <link rel="stylesheet" href="assets/css/gmp-portal.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Teste do Gerenciador de Banco de Dados</h1>
        
        <div class="test-section">
            <h2>Teste de conexão</h2>
            <button onclick="testConnection()">Testar conexão com banco de dados</button>
            <button onclick="testConnectionStatus()">Verificar status da conexão</button>
            <div id="connection-results" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Teste de operações básicas</h2>
            <button onclick="testCreateTable()">Criar tabela de teste</button>
            <button onclick="testInsertData()">Inserir dados de teste</button>
            <button onclick="testQueryData()">Consultar dados de teste</button>
            <button onclick="testUpdateData()">Atualizar dados de teste</button>
            <button onclick="testDeleteData()">Excluir dados de teste</button>
            <div id="basic-results" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Teste de recursos avançados</h2>
            <button onclick="testTransaction()">Teste de transação</button>
            <button onclick="testBatchOperation()">Teste de operações em lote</button>
            <button onclick="testStoredProcedure()">Teste de procedimento armazenado</button>
            <div id="advanced-results" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Teste de integração Oracle</h2>
            <button onclick="testOracleConnection()">Testar conexão Oracle</button>
            <button onclick="testOracleQuery()">Testar consulta Oracle</button>
            <button onclick="testOracleSync()">Testar sincronização de dados</button>
            <div id="oracle-results" class="test-result"></div>
        </div>
    </div>

    <script>
        let testResults = {
            connection: [],
            basic: [],
            advanced: [],
            oracle: []
        };

        function logResult(category, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testResults[category].push(logEntry);
            updateResults(category);
        }

        function updateResults(category) {
            const container = document.getElementById(category + '-results');
            if (container) {
                container.innerHTML = testResults[category].join('\n');
                container.scrollTop = container.scrollHeight;
            }
        }

        // ============================
        // LOCALSTORAGE IMPLEMENTAÇÃO
        // ============================

        function testConnection() {
            try {
                logResult('connection', 'Testando conexão com localStorage...', 'info');
                localStorage.setItem('db_test_key', 'ok');
                logResult('connection', 'Conexão estabelecida com localStorage', 'success');
            } catch (e) {
                logResult('connection', 'Falha ao acessar localStorage: ' + e.message, 'error');
            }
        }

        function testConnectionStatus() {
            const value = localStorage.getItem('db_test_key');
            if (value) {
                logResult('connection', JSON.stringify({
                    connected: true,
                    type: 'localStorage',
                    lastActivity: new Date().toISOString(),
                    available: true
                }), 'success');
            } else {
                logResult('connection', 'Nenhuma chave encontrada no localStorage', 'warning');
            }
        }

        function testCreateTable() {
            logResult('basic', 'Simulando criação de tabela no localStorage...', 'info');
            localStorage.setItem('test_users', JSON.stringify([]));
            logResult('basic', 'Tabela test_users criada em localStorage', 'success');
        }

        function testInsertData() {
            logResult('basic', 'Inserindo dados no localStorage...', 'info');
            let users = JSON.parse(localStorage.getItem('test_users') || '[]');
            const user = { id: 1, username: 'testuser', email: 'test@example.com' };
            users.push(user);
            localStorage.setItem('test_users', JSON.stringify(users));
            logResult('basic', 'Usuário salvo: ' + JSON.stringify(user), 'success');
        }

        function testQueryData() {
            logResult('basic', 'Consultando dados no localStorage...', 'info');
            let users = JSON.parse(localStorage.getItem('test_users') || '[]');
            logResult('basic', 'Resultado da consulta: ' + JSON.stringify(users, null, 2), 'success');
        }

        function testUpdateData() {
            logResult('basic', 'Atualizando dados no localStorage...', 'info');
            let users = JSON.parse(localStorage.getItem('test_users') || '[]');
            let user = users.find(u => u.username === 'testuser');
            if (user) {
                user.email = 'updated@example.com';
                localStorage.setItem('test_users', JSON.stringify(users));
                logResult('basic', 'Usuário atualizado: ' + JSON.stringify(user), 'success');
            } else {
                logResult('basic', 'Usuário não encontrado', 'error');
            }
        }

        function testDeleteData() {
            logResult('basic', 'Excluindo dados do localStorage...', 'info');
            let users = JSON.parse(localStorage.getItem('test_users') || '[]');
            users = users.filter(u => u.username !== 'testuser');
            localStorage.setItem('test_users', JSON.stringify(users));
            logResult('basic', 'Usuário testuser removido', 'success');
        }

        // Mantive os testes avançados e Oracle como estavam (simulados)
        async function testTransaction() {
            logResult('advanced', 'Transação simulada em localStorage', 'info');
            logResult('advanced', JSON.stringify({ success: true, message: 'Transação executada com sucesso' }), 'success');
        }

        async function testBatchOperation() {
            logResult('advanced', 'Operações em lote simuladas em localStorage', 'info');
            logResult('advanced', JSON.stringify({ success: true, totalAffected: 0 }), 'success');
        }

        async function testStoredProcedure() {
            logResult('advanced', 'Procedimento armazenado não suportado em localStorage', 'error');
        }

        async function testOracleConnection() {
            logResult('oracle', 'Integração Oracle simulada - configure no OCI', 'warning');
        }

        async function testOracleQuery() {
            logResult('oracle', 'Consulta Oracle simulada - configure no OCI', 'warning');
        }

        async function testOracleSync() {
            logResult('oracle', 'Sincronização Oracle simulada - configure no OCI', 'warning');
        }

        document.addEventListener('DOMContentLoaded', function() {
            logResult('connection', 'Página de teste do gerenciador de banco de dados carregada', 'info');
            logResult('basic', 'Teste de operações básicas pronto', 'info');
            logResult('advanced', 'Teste de recursos avançados pronto', 'info');
            logResult('oracle', 'Teste de integração Oracle pronto', 'info');
        });
    </script>
</body>
</html>
