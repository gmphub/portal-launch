<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Integração do gmp Portal</title>
    <link rel="stylesheet" href="assets/css/gmp-portal.css">
    <style>
        .test-container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin-top: 10px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .success { color: #28a745; } .error { color: #dc3545; } .info { color: #17a2b8; } .warning { color: #ffc107; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Teste de Integração do gmp Portal</h1>

        <div class="test-section">
            <h2>Verificação de status do sistema</h2>
            <button onclick="checkSystemStatus()">Verificar status do sistema</button>
            <div id="system-results" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>Teste de autenticação de usuário</h2>
            <button onclick="testUserAuth()">Testar autenticação de usuário</button>
            <button onclick="testUserRegistration()">Testar registro de usuário</button>
            <button onclick="testPasswordReset()">Testar redefinição de senha</button>
            <div id="auth-results" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>Teste de controle de acesso a dados</h2>
            <button onclick="testDataAccess()">Testar controle de acesso a dados</button>
            <button onclick="testRoleBasedAccess()">Testar acesso baseado em papéis</button>
            <button onclick="testAuditLogs()">Testar log de auditoria</button>
            <div id="access-results" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>Teste de integração Oracle</h2>
            <button onclick="testOracleIntegration()">Testar integração Oracle</button>
            <button onclick="testDataSync()">Testar sincronização de dados</button>
            <button onclick="testCrossDBQuery()">Testar consulta entre bancos</button>
            <div id="oracle-results" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>Teste completo de integração</h2>
            <button onclick="runFullIntegrationTest()">Executar teste completo de integração</button>
            <div id="full-results" class="test-result"></div>
        </div>
    </div>
    <script src="assets/js/integration.js"></script>
    <script>
        let testResults = {
            system: [],
            auth: [],
            access: [],
            oracle: [],
            full: []
        };

        function logResult(category, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testResults[category].push(logEntry);
            updateResults(category);
        }

        function updateResults(category) {
            const container = document.getElementById(category + '-results');
            if (container) {
                container.innerHTML = testResults[category].join('\n');
                container.scrollTop = container.scrollHeight;
            }
        }

        async function checkSystemStatus() {
            try {
                logResult('system', 'Iniciando verificação de status do sistema...', 'info');
                const status = {
                    database: 'OK',
                    security: 'OK',
                    browser: navigator.userAgent,
                    storage: typeof(Storage) !== 'undefined'
                };
                logResult('system', `Status do banco de dados: ${status.database}`, 'success');
                logResult('system', `Status do módulo de segurança: ${status.security}`, 'success');
                logResult('system', `Informações do navegador: ${status.browser}`, 'info');
                logResult('system', `Suporte de armazenamento: ${status.storage}`, 'info');
                logResult('system', 'Verificação de status concluída', 'success');
            } catch (error) {
                logResult('system', `Falha na verificação de status: ${error.message}`, 'error');
            }
        }

        async function testUserAuth() {
            try {
                logResult('auth', 'Iniciando teste de autenticação...', 'info');
                const loginResult = await GMP_Integration.testLogin('testuser', 'password123');
                logResult('auth', `Resultado do login: ${JSON.stringify(loginResult)}`,
                    loginResult.success ? 'success' : 'error');
                logResult('auth', 'Teste de autenticação concluído', 'success');
            } catch (error) {
                logResult('auth', `Falha no teste de autenticação: ${error.message}`, 'error');
            }
        }

        async function testUserRegistration() {
            try {
                logResult('auth', 'Iniciando teste de fluxo de registro...', 'info');
                const regResult = await GMP_Integration.testRegistration({
                    username: 'newuser',
                    password: 'Test123!@#',
                    email: 'new@example.com'
                });
                logResult('auth', `Resultado do registro: ${JSON.stringify(regResult)}`,
                    regResult.success ? 'success' : 'error');
                logResult('auth', 'Fluxo de registro concluído', 'success');
            } catch (error) {
                logResult('auth', `Falha no teste de registro: ${error.message}`, 'error');
            }
        }

        async function testPasswordReset() {
            try {
                logResult('auth', 'Iniciando teste de redefinição de senha...', 'info');
                const resetResult = await GMP_Integration.testPasswordReset('testuser');
                logResult('auth', `Resultado da redefinição: ${JSON.stringify(resetResult)}`,
                    resetResult.success ? 'success' : 'error');
                logResult('auth', 'Teste de redefinição concluído', 'success');
            } catch (error) {
                logResult('auth', `Falha no teste de redefinição: ${error.message}`, 'error');
            }
        }

        async function testDataAccess() {
            try {
                logResult('access', 'Iniciando teste de controle de acesso...', 'info');
                const accessResult = await GMP_Integration.testDataAccess();
                logResult('access', `Resultado do acesso: ${JSON.stringify(accessResult)}`,
                    accessResult.success ? 'success' : 'error');
                logResult('access', 'Teste de controle de acesso concluído', 'success');
            } catch (error) {
                logResult('access', `Falha no teste de acesso: ${error.message}`, 'error');
            }
        }

        async function testRoleBasedAccess() {
            try {
                logResult('access', 'Iniciando teste de acesso baseado em papéis...', 'info');
                const roleResult = await GMP_Integration.testRoleAccess();
                logResult('access', `Resultado do acesso por papéis: ${JSON.stringify(roleResult)}`,
                    roleResult.success ? 'success' : 'error');
                logResult('access', 'Teste de acesso baseado em papéis concluído', 'success');
            } catch (error) {
                logResult('access', `Falha no teste de papéis: ${error.message}`, 'error');
            }
        }

        async function testAuditLogs() {
            try {
                logResult('access', 'Iniciando teste de log de auditoria...', 'info');
                const auditResult = await GMP_Integration.testAuditLogs();
                logResult('access', `Resultado do log de auditoria: ${JSON.stringify(auditResult)}`,
                    auditResult.success ? 'success' : 'error');
                logResult('access', 'Teste de log de auditoria concluído', 'success');
            } catch (error) {
                logResult('access', `Falha no teste de auditoria: ${error.message}`, 'error');
            }
        }

        async function testOracleIntegration() {
            try {
                logResult('oracle', 'Iniciando teste de integração Oracle...', 'info');
                const oracleResult = await GMP_Integration.testOracle();
                logResult('oracle', `Resultado da integração Oracle: ${JSON.stringify(oracleResult)}`,
                    oracleResult.success ? 'success' : 'error');
                logResult('oracle', 'Teste de integração Oracle concluído', 'success');
            } catch (error) {
                logResult('oracle', `Falha no teste Oracle: ${error.message}`, 'error');
            }
        }

        async function testDataSync() {
            try {
                logResult('oracle', 'Iniciando teste de sincronização de dados...', 'info');
                const syncResult = await GMP_Integration.testDataSync();
                logResult('oracle', `Resultado da sincronização: ${JSON.stringify(syncResult)}`,
                    syncResult.success ? 'success' : 'error');
                logResult('oracle', 'Teste de sincronização concluído', 'success');
            } catch (error) {
                logResult('oracle', `Falha no teste de sincronização: ${error.message}`, 'error');
            }
        }

        async function testCrossDBQuery() {
            try {
                logResult('oracle', 'Iniciando teste de consulta entre bancos...', 'info');
                const crossResult = await GMP_Integration.testCrossDBQuery();
                logResult('oracle', `Resultado da consulta entre bancos: ${JSON.stringify(crossResult)}`,
                    crossResult.success ? 'success' : 'error');
                logResult('oracle', 'Teste de consulta entre bancos concluído', 'success');
            } catch (error) {
                logResult('oracle', `Falha na consulta entre bancos: ${error.message}`, 'error');
            }
        }

        async function runFullIntegrationTest() {
            try {
                logResult('full', 'Iniciando teste completo de integração...', 'info');
                await checkSystemStatus();
                await testUserAuth();
                await testUserRegistration();
                await testPasswordReset();
                await testDataAccess();
                await testRoleBasedAccess();
                await testAuditLogs();
                await testOracleIntegration();
                await testDataSync();
                await testCrossDBQuery();
                logResult('full', 'Teste completo de integração concluído', 'success');
            } catch (error) {
                logResult('full', `Falha no teste completo: ${error.message}`, 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            logResult('system', 'Página de teste de integração do gmp Portal carregada', 'info');
            logResult('auth', 'Teste de autenticação pronto', 'info');
            logResult('access', 'Teste de acesso a dados pronto', 'info');
            logResult('oracle', 'Teste de integração Oracle pronto', 'info');
            logResult('full', 'Teste completo de integração pronto', 'info');
        });
    </script>
</body>
</html>
